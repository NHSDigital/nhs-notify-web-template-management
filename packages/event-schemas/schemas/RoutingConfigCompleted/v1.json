{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "maxLength": 1000,
      "description": "Unique ID for this event"
    },
    "time": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d{3}Z$",
      "description": "Time the event was generated"
    },
    "type": {
      "type": "string",
      "const": "uk.nhs.notify.template-management.RoutingConfigCompleted.v1"
    },
    "source": {
      "type": "string",
      "description": "Source of the event"
    },
    "specversion": {
      "type": "string",
      "const": "1.0",
      "description": "Version of the envelope event schema"
    },
    "datacontenttype": {
      "type": "string",
      "const": "application/json",
      "description": "Always application/json"
    },
    "subject": {
      "type": "string",
      "format": "uuid",
      "pattern": "^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$",
      "description": "Unique identifier for the item in the event data"
    },
    "dataschema": {
      "type": "string",
      "const": "https://notify.nhs.uk/events/schemas/RoutingConfigCompleted/v1.json"
    },
    "dataschemaversion": {
      "type": "string",
      "pattern": "^1\\..*"
    },
    "plane": {
      "type": "string",
      "const": "control"
    },
    "data": {
      "type": "object",
      "properties": {
        "clientId": {
          "type": "string",
          "description": "The client that owns the routing config"
        },
        "campaignId": {
          "type": "string",
          "description": "The campaign that is associated with the routing config"
        },
        "id": {
          "type": "string",
          "pattern": "^[\\dA-Fa-f]{8}(?:-[\\dA-Fa-f]{4}){3}-[\\dA-Fa-f]{12}$",
          "description": "Unique identifier of the routing config"
        },
        "name": {
          "type": "string",
          "description": "User-provided name identifying the routing config"
        },
        "defaultCascadeGroup": {
          "type": "string",
          "description": "Default cascade group name"
        },
        "createdAt": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$",
          "description": "Timestamp for when the routing config was created"
        },
        "cascade": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/CascadeItem"
          },
          "description": "Array defining the order of channels for the routing config and how they are configured"
        },
        "cascadeGroupOverrides": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/CascadeGroupOverride"
          },
          "description": "Config defining non-default cascade groups and the conditons under which they will be used"
        }
      },
      "required": [
        "clientId",
        "campaignId",
        "id",
        "name",
        "defaultCascadeGroup",
        "createdAt",
        "cascade",
        "cascadeGroupOverrides"
      ]
    }
  },
  "required": [
    "id",
    "time",
    "type",
    "source",
    "specversion",
    "datacontenttype",
    "subject",
    "dataschema",
    "dataschemaversion",
    "plane",
    "data"
  ],
  "$defs": {
    "CascadeItem": {
      "type": "object",
      "properties": {
        "channel": {
          "type": "string",
          "enum": [
            "NHSAPP",
            "EMAIL",
            "SMS",
            "LETTER"
          ],
          "description": "Communication type for this cascade item"
        },
        "channelType": {
          "type": "string",
          "enum": [
            "primary",
            "secondary"
          ],
          "description": "Channel type for this cascade item"
        },
        "supplierReferences": {
          "description": "Supplier references that identify the template",
          "type": "object",
          "propertyNames": {
            "type": "string"
          },
          "additionalProperties": {
            "type": "string"
          }
        },
        "conditionalTemplates": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/ConditionalTemplate"
          }
        },
        "cascadeGroups": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of cascade groups that the cascade item will be included in"
        },
        "defaultTemplateId": {
          "description": "Unique identifier for the template to use if no conditions for conditionalTemplates are satisfied",
          "type": "string",
          "pattern": "^[\\dA-Fa-f]{8}(?:-[\\dA-Fa-f]{4}){3}-[\\dA-Fa-f]{12}$"
        }
      },
      "required": [
        "channel",
        "channelType",
        "cascadeGroups"
      ]
    },
    "ConditionalTemplate": {
      "type": "object",
      "properties": {
        "language": {
          "description": "Language override for the template",
          "type": "string",
          "enum": [
            "ar",
            "bg",
            "bn",
            "de",
            "el",
            "en",
            "es",
            "fa",
            "fr",
            "gu",
            "hi",
            "hu",
            "it",
            "ku",
            "lt",
            "lv",
            "ne",
            "pa",
            "pl",
            "pt",
            "ro",
            "ru",
            "sk",
            "so",
            "sq",
            "ta",
            "tr",
            "ur",
            "zh"
          ]
        },
        "accessibleFormat": {
          "description": "Communication preference override for the template",
          "type": "string",
          "enum": [
            "x1"
          ]
        },
        "supplierReferences": {
          "description": "Supplier references that identify the template",
          "type": "object",
          "propertyNames": {
            "type": "string"
          },
          "additionalProperties": {
            "type": "string"
          }
        },
        "templateId": {
          "type": "string",
          "pattern": "^[\\dA-Fa-f]{8}(?:-[\\dA-Fa-f]{4}){3}-[\\dA-Fa-f]{12}$",
          "description": "Unique identifier for the template"
        }
      },
      "required": [
        "templateId"
      ]
    },
    "CascadeGroupOverride": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "accessibleFormat": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "language": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "name"
      ]
    }
  },
  "$id": "https://notify.nhs.uk/events/schemas/RoutingConfigCompleted/v1.json"
}
