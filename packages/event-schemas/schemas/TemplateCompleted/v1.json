{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "maxLength": 1000,
      "description": "Unique ID for this event"
    },
    "time": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d{3}Z$",
      "description": "Time the event was generated"
    },
    "type": {
      "type": "string",
      "const": "uk.nhs.notify.template-management.TemplateCompleted.v1"
    },
    "source": {
      "type": "string",
      "description": "Source of the event"
    },
    "specversion": {
      "type": "string",
      "const": "1.0",
      "description": "Version of the envelope event schema"
    },
    "datacontenttype": {
      "type": "string",
      "const": "application/json",
      "description": "Always application/json"
    },
    "subject": {
      "type": "string",
      "format": "uuid",
      "pattern": "^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$",
      "description": "Unique identifier for the item in the event data"
    },
    "dataschema": {
      "type": "string",
      "const": "https://notify.nhs.uk/events/schemas/TemplateCompleted/v1.json"
    },
    "dataschemaversion": {
      "type": "string",
      "pattern": "^1\\..*"
    },
    "plane": {
      "type": "string",
      "const": "control"
    },
    "data": {
      "$ref": "#/$defs/TemplateEventData"
    }
  },
  "required": [
    "id",
    "time",
    "type",
    "source",
    "specversion",
    "datacontenttype",
    "subject",
    "dataschema",
    "dataschemaversion",
    "plane",
    "data"
  ],
  "$defs": {
    "TemplateEventData": {
      "oneOf": [
        {
          "$ref": "#/$defs/EmailTemplateEventData"
        },
        {
          "$ref": "#/$defs/NhsAppTemplateEventData"
        },
        {
          "$ref": "#/$defs/LetterTemplateEventData"
        },
        {
          "$ref": "#/$defs/SmsTemplateEventData"
        }
      ]
    },
    "EmailTemplateEventData": {
      "type": "object",
      "properties": {
        "owner": {
          "type": "string",
          "description": "The client that owns the template"
        },
        "id": {
          "type": "string",
          "pattern": "^[\\dA-Fa-f]{8}(?:-[\\dA-Fa-f]{4}){3}-[\\dA-Fa-f]{12}$",
          "description": "Unique identifier for the template"
        },
        "clientId": {
          "description": "The client that owns the template",
          "type": "string",
          "maxLength": 1000
        },
        "createdAt": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$",
          "description": "Timestamp for when the template was initially created"
        },
        "createdBy": {
          "description": "Unique identifier for the user that initially created the template",
          "type": "string",
          "maxLength": 1000
        },
        "name": {
          "type": "string",
          "maxLength": 1000,
          "description": "User-provided template name"
        },
        "updatedAt": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$",
          "description": "Timestamp for when the template was most recently updated"
        },
        "updatedBy": {
          "description": "Unique identifier for the user that most recently updated the template",
          "type": "string",
          "maxLength": 1000
        },
        "message": {
          "type": "string",
          "maxLength": 100000,
          "description": "Message body for the email template"
        },
        "subject": {
          "type": "string",
          "maxLength": 1000,
          "description": "Subject field for the email template"
        },
        "templateType": {
          "type": "string",
          "const": "EMAIL",
          "description": "Template type"
        }
      },
      "required": [
        "owner",
        "id",
        "createdAt",
        "name",
        "updatedAt",
        "message",
        "subject",
        "templateType"
      ]
    },
    "NhsAppTemplateEventData": {
      "type": "object",
      "properties": {
        "owner": {
          "type": "string",
          "description": "The client that owns the template"
        },
        "id": {
          "type": "string",
          "pattern": "^[\\dA-Fa-f]{8}(?:-[\\dA-Fa-f]{4}){3}-[\\dA-Fa-f]{12}$",
          "description": "Unique identifier for the template"
        },
        "clientId": {
          "description": "The client that owns the template",
          "type": "string",
          "maxLength": 1000
        },
        "createdAt": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$",
          "description": "Timestamp for when the template was initially created"
        },
        "createdBy": {
          "description": "Unique identifier for the user that initially created the template",
          "type": "string",
          "maxLength": 1000
        },
        "name": {
          "type": "string",
          "maxLength": 1000,
          "description": "User-provided template name"
        },
        "updatedAt": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$",
          "description": "Timestamp for when the template was most recently updated"
        },
        "updatedBy": {
          "description": "Unique identifier for the user that most recently updated the template",
          "type": "string",
          "maxLength": 1000
        },
        "message": {
          "type": "string",
          "maxLength": 5000,
          "description": "Message body for the NHS App template"
        },
        "templateType": {
          "type": "string",
          "const": "NHS_APP",
          "description": "Template type"
        }
      },
      "required": [
        "owner",
        "id",
        "createdAt",
        "name",
        "updatedAt",
        "message",
        "templateType"
      ]
    },
    "LetterTemplateEventData": {
      "type": "object",
      "properties": {
        "owner": {
          "type": "string",
          "description": "The client that owns the template"
        },
        "id": {
          "type": "string",
          "pattern": "^[\\dA-Fa-f]{8}(?:-[\\dA-Fa-f]{4}){3}-[\\dA-Fa-f]{12}$",
          "description": "Unique identifier for the template"
        },
        "clientId": {
          "description": "The client that owns the template",
          "type": "string",
          "maxLength": 1000
        },
        "createdAt": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$",
          "description": "Timestamp for when the template was initially created"
        },
        "createdBy": {
          "description": "Unique identifier for the user that initially created the template",
          "type": "string",
          "maxLength": 1000
        },
        "name": {
          "type": "string",
          "maxLength": 1000,
          "description": "User-provided template name"
        },
        "updatedAt": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$",
          "description": "Timestamp for when the template was most recently updated"
        },
        "updatedBy": {
          "description": "Unique identifier for the user that most recently updated the template",
          "type": "string",
          "maxLength": 1000
        },
        "files": {
          "type": "object",
          "properties": {
            "proofs": {
              "type": "object",
              "propertyNames": {
                "type": "string"
              },
              "additionalProperties": {
                "type": "object",
                "properties": {
                  "supplier": {
                    "type": "string",
                    "maxLength": 1000
                  }
                },
                "required": [
                  "supplier"
                ]
              }
            }
          },
          "description": "Object containing information about proofs attached to the template"
        },
        "templateType": {
          "type": "string",
          "const": "LETTER",
          "description": "Template type"
        },
        "language": {
          "type": "string",
          "enum": [
            "ar",
            "bg",
            "bn",
            "de",
            "el",
            "en",
            "es",
            "fa",
            "fr",
            "gu",
            "hi",
            "hu",
            "it",
            "ku",
            "lt",
            "lv",
            "ne",
            "pa",
            "pl",
            "pt",
            "ro",
            "ru",
            "sk",
            "so",
            "sq",
            "ta",
            "tr",
            "ur",
            "zh"
          ],
          "description": "ISO 639 language code for the language the letter template is written in"
        },
        "letterType": {
          "type": "string",
          "enum": [
            "q4",
            "x0",
            "x1"
          ],
          "description": "Letter type - q4:British Sign Language, x1:Large Print, x0:Standard"
        },
        "personalisationParameters": {
          "type": "array",
          "items": {
            "type": "string",
            "maxLength": 1000
          },
          "description": "List of personalisation parameters used in the template"
        },
        "supplierReferences": {
          "type": "object",
          "propertyNames": {
            "type": "string"
          },
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "required": [
        "owner",
        "id",
        "createdAt",
        "name",
        "updatedAt",
        "files",
        "templateType",
        "language",
        "letterType",
        "personalisationParameters"
      ]
    },
    "SmsTemplateEventData": {
      "type": "object",
      "properties": {
        "owner": {
          "type": "string",
          "description": "The client that owns the template"
        },
        "id": {
          "type": "string",
          "pattern": "^[\\dA-Fa-f]{8}(?:-[\\dA-Fa-f]{4}){3}-[\\dA-Fa-f]{12}$",
          "description": "Unique identifier for the template"
        },
        "clientId": {
          "description": "The client that owns the template",
          "type": "string",
          "maxLength": 1000
        },
        "createdAt": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$",
          "description": "Timestamp for when the template was initially created"
        },
        "createdBy": {
          "description": "Unique identifier for the user that initially created the template",
          "type": "string",
          "maxLength": 1000
        },
        "name": {
          "type": "string",
          "maxLength": 1000,
          "description": "User-provided template name"
        },
        "updatedAt": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$",
          "description": "Timestamp for when the template was most recently updated"
        },
        "updatedBy": {
          "description": "Unique identifier for the user that most recently updated the template",
          "type": "string",
          "maxLength": 1000
        },
        "message": {
          "type": "string",
          "maxLength": 918,
          "description": "Message body for the NHS App template"
        },
        "templateType": {
          "type": "string",
          "const": "SMS",
          "description": "Template type"
        }
      },
      "required": [
        "owner",
        "id",
        "createdAt",
        "name",
        "updatedAt",
        "message",
        "templateType"
      ]
    }
  },
  "$id": "https://notify.nhs.uk/events/schemas/TemplateCompleted/v1.json"
}
