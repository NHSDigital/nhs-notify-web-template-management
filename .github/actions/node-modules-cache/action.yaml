name: "Node modules cache + setup"
description: "Setup Node, restore node_modules cache, and optionally run pnpm install on cache miss"
inputs:
  node_version:
    description: "Node.js version"
    required: true
  cache_lock_path:
    description: "Path(s) to package-lock.json for cache key"
    required: false
    default: "**/package-lock.json"
runs:
  using: "composite"
  steps:
    - name: "Use Node.js"
      uses: actions/setup-node@v4
      with:
        node-version: "${{ inputs.node_version }}"
        cache: "pnpm"
        cache-dependency-path: "${{ inputs.cache_lock_path }}"
    - name: "Restore node_modules from cache"
      id: node-modules-cache
      uses: actions/cache@v4
      with:
        path: |
          node_modules
          **/node_modules
        key: ${{ runner.os }}-node-${{ inputs.node_version }}-${{ hashFiles(inputs.cache_lock_path) }}
        restore-keys: |
          ${{ runner.os }}-node-${{ inputs.node_version }}-
    - name: "Install dependencies (cache miss)"
      if: steps.node-modules-cache.outputs.cache-hit != 'true'
      shell: bash
      run: |
        pnpm install
